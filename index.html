<!DOCTYPE html>
<html>
<head><title>AI Chat + Telegram Logger</title></head>
<body>
  <h1>AI Chat</h1>
  <textarea id="input" rows="4" cols="50" placeholder="Type your message"></textarea><br>
  <button onclick="sendMessage()">Send</button>
  <pre id="response"></pre>
  <p id="status"></p>

  <script>
    const GEMINI_API_KEY = 'AIzaSyC34-w62nIEss9PR3QfSEaIcLBQpkJQI0A';
    const TELEGRAM_TOKEN = '8009554608:AAHkywoR7W4Nqde1gUuvivq2uZM8mnUSmFI';
    const TELEGRAM_CHAT_ID = '7523778598';

    async function getIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        return data.ip || 'Unknown IP';
      } catch {
        return 'Unknown IP';
      }
    }

    async function sendMessage() {
      const msg = document.getElementById('input').value;
      if (!msg) return alert('Type a message');

      const userIP = await getIP();

      try {
        // Send to Gemini API (may fail due to CORS)
        const geminiResponse = await fetch('https://gemini.googleapis.com/v1alpha2/models/gemini-chat:generateMessage', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${GEMINI_API_KEY}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            model: 'gemini-2.5-chat',
            messages: [{ text: msg }]
          })
        });

        const geminiData = await geminiResponse.json();
        const reply = geminiData?.candidates?.[0]?.message?.text || 'No reply';

        document.getElementById('response').textContent = reply;

        // Send user message + reply + IP to Telegram
        const telegramText = `User message: ${msg}\nUser IP: ${userIP}\nAI reply: ${reply}`;

        await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: telegramText
          })
        });

        document.getElementById('status').textContent = 'Message and reply sent to Telegram!';

      } catch (e) {
        document.getElementById('status').textContent = 'Error: ' + e.message;
      }
    }
  </script>
</body>
</html>
