<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Click a Jude — IDRC</title>
<style>
:root {
  --bg: #08090b;
  --panel: #0f1316;
  --muted: #99a3b2;
  --accent: #00e6ff;
  --accent-2: #7b61ff;
  --glass: rgba(255,255,255,0.03);
  --good: #6ef08a;
  --bad: #ff6e6e;
  --card-radius: 12px;
}
html,body { height:100%; margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: linear-gradient(180deg,#050506 0%, #0c0f12 100%); color:#e8f7ff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
* { box-sizing: border-box; }
.app { max-width:1100px; margin: 10px auto; padding: 12px; display: grid; grid-template-columns: 1fr; gap: 12px; }
@media(min-width:900px){ .app { grid-template-columns: 360px 1fr 360px; align-items:start; } }
header { grid-column: 1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px; padding: 8px 6px; }
.brand { display:flex; align-items:center; gap:12px; }
.logo { width:56px; height:56px; border-radius:12px; overflow:hidden; border:3px solid rgba(0,230,255,0.08); background:#071018; display:flex;align-items:center;justify-content:center; }
.logo img { width:100%; height:100%; object-fit:cover; display:block; user-select:none; -webkit-user-drag:none; }
.title { font-weight:700; letter-spacing:0.4px; font-size:18px; margin:0; }
.subtitle { font-size:12px; color:var(--muted); margin-top:3px; }
.top-stats { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.stat { min-width:120px; background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:10px; padding:8px 10px; text-align:center; border:1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
.stat .label { font-size:12px; color:var(--muted); }
.stat .value { font-weight:800; color:var(--accent); margin-top:6px; font-size:16px; }
.panel { background:var(--panel); border-radius:var(--card-radius); padding:12px; box-shadow: 0 12px 32px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.03); }
.click-area { display:flex; flex-direction:column; align-items:center; gap:10px; padding:16px; }
#clickImg { width:220px; height:220px; border-radius:14px; object-fit:cover; border:5px solid rgba(0,230,255,0.06); transition: transform .08s ease; touch-action: manipulation; -webkit-tap-highlight-color: transparent; cursor:pointer; }
#clickImg:active { transform: scale(.96) rotate(-1deg); }
.big-number { font-size:20px; font-weight:700; color:#fff; }
.small { font-size:12px; color:var(--muted); }
.controls { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:6px; }
button.btn { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--accent); padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; transition: transform .12s ease, background .12s ease; }
button.btn.secondary { background: rgba(255,255,255,0.02); color:#fff; }
button.btn:active{ transform: translateY(1px); }
button.btn.disabled{ opacity:.45; pointer-events:none; }
.upgrades { display:grid; gap:12px; }
.upgrid { display:grid; grid-template-columns: repeat(1,1fr); gap:8px; max-height:420px; overflow:auto; padding-right:6px; }
@media(min-width:1100px){ .upgrid { grid-template-columns: repeat(2,1fr);} }
.upgrade { display:flex; justify-content:space-between; align-items:center; gap:12px; padding:10px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.03); cursor:pointer; transition: transform .12s, box-shadow .12s; }
.upgrade:hover{ transform: translateY(-4px); box-shadow: 0 16px 40px rgba(0,0,0,0.6); }
.upgrade .meta { display:flex; flex-direction:column; gap:4px; align-items:flex-start; text-align:left; }
.upgrade .title { font-weight:800; font-size:14px; }
.upgrade .desc { font-size:12px; color:var(--muted); }
.upgrade .cost { font-weight:800; color:var(--accent); }
.glow { box-shadow: 0 0 28px rgba(0,230,255,0.15), 0 0 80px rgba(0,230,255,0.06) !important; border-color: rgba(0,230,255,0.12) !important; }
.right-stack { display:flex; flex-direction:column; gap:12px; }
.ad-btn { width:100%; background:transparent; border:1px solid rgba(255,255,255,0.04); color:#fff; padding:10px; border-radius:10px; cursor:pointer; font-weight:800; }
.ad-btn.disabled { opacity:.45; pointer-events:none; }
.modal-backdrop { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.65); z-index:9999; }
.modal { background:var(--panel); padding:18px; border-radius:12px; width:min(640px,92%); border:1px solid rgba(255,255,255,0.03); }
.modal h3 { margin:0 0 8px 0; }
.modal .actions { display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }
.float { position:fixed; pointer-events:none; font-weight:800; color:var(--accent); text-shadow:0 6px 18px rgba(0,0,0,0.6); transform-origin:center; }
.spark { position:fixed; width:6px; height:6px; border-radius:50%; pointer-events:none; opacity:0.95; }
.muted { color:var(--muted); font-size:13px; }
.centered { display:flex; align-items:center; justify-content:center; }
/* bottom guide button */
#appGuideBtn { position:fixed; bottom:12px; left:50%; transform:translateX(-50%); background:var(--accent); color:#000; font-weight:700; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; z-index:10000; font-size:14px; }
@media(max-width:600px){ #clickImg{width:160px;height:160px;} .big-number{font-size:18px;} .stat{min-width:80px;} }
</style>
</head>
<body>
<div class="app" id="appRoot">
<header>
  <div class="brand">
    <div class="logo"><img id="logoImg" src="IMG_7281.jpeg" alt="logo" draggable="false" /></div>
    <div>
      <div class="title">Click a Jude — IDRC</div>
      <div class="subtitle">Tap, upgrade, ascend — mobile + desktop optimized</div>
    </div>
  </div>
  <div class="top-stats">
    <div class="stat"><div class="label">Money</div><div class="value" id="moneyDisplay">$0</div></div>
    <div class="stat"><div class="label">Per Click</div><div class="value" id="perClickDisplay">1</div></div>
    <div class="stat"><div class="label">Auto / sec</div><div class="value" id="autoDisplay">0</div></div>
    <div class="stat"><div class="label">Asc Coins</div><div class="value" id="ascDisplay">0</div></div>
  </div>
</header>

<div class="panel centered" id="leftCol">
  <div class="click-area" style="width:100%">
    <div class="big-number">Click the Jude</div>
    <img id="clickImg" src="IMG_7281.jpeg" alt="Click Jude" draggable="false" />
    <div class="small">Tap or press Space / Enter (no holding)</div>
    <div class="controls" style="margin-top:8px">
      <button class="btn secondary" id="exportBtn" type="button">Export Save</button>
      <button class="btn secondary" id="importBtn" type="button">Import Save</button>
      <button class="btn" id="resetBtn" type="button">Reset</button>
    </div>
  </div>
</div>

<div class="panel upgrades" id="centerCol">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
    <h3 style="margin:0">Click Upgrades</h3>
    <div class="muted">Tap to buy — costs increase after purchase</div>
  </div>
  <div id="clickGrid" class="upgrid"></div>

  <div style="height:8px"></div>

  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
    <h3 style="margin:0">Auto Upgrades</h3>
    <div class="muted">Earn while away (runs every second)</div>
  </div>
  <div id="autoGrid" class="upgrid"></div>
</div>

<div class="panel right-stack" id="rightCol">
  <div>
    <h3 style="margin:0 0 8px 0">Ascension</h3>
    <div class="muted">Reach <b>$5,000,000</b> to unlock Ascend</div>
    <div style="height:10px"></div>
    <button id="ascendBtn" class="btn" type="button" style="width:100%; display:none;">Ascend</button>
    <div style="height:8px"></div>
    <div class="muted">Ascension Coins: <span id="ascCoins">0</span></div>

    <div style="height:12px"></div>

    <!-- Ascension upgrades grid (buys with asc coins) -->
    <div style="margin-top:8px;">
      <h4 style="margin:0 0 6px 0">Ascension Upgrades</h4>
      <div class="muted" style="margin-bottom:8px">Spend Asc Coins to buy permanent boosts</div>
      <div id="ascGrid" class="upgrid" style="max-height:240px;"></div>
    </div>

  </div>

  <div style="height:12px"></div>

  <div>
    <h3 style="margin:0 0 8px 0">Ads</h3>
    <div class="muted">Click ad — +$50,000 (rotates through links)</div>
    <div style="height:8px"></div>
    <button id="adButton" class="ad-btn" type="button">Watch Ad (+50k)</button>
    <div style="height:8px"></div>
    <div id="adStatus" class="muted"></div>
  </div>
</div>

<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-hidden="true">
  <div class="modal">
    <h3>Ascend?</h3>
    <div id="ascModalText" class="muted" style="margin-top:6px;"></div>
    <div class="actions" style="margin-top:12px">
      <button id="modalCancel" class="btn secondary" type="button">Cancel</button>
      <button id="modalConfirm" class="btn" type="button">Confirm Ascend</button>
    </div>
  </div>
</div>

<div id="floatRoot" aria-hidden="true"></div>

<button id="appGuideBtn" type="button" onclick="alert('iOS Safari: Tap the share icon → Add to Home Screen → Name it → Done.\\nAndroid/Chrome: Tap menu → Add to Home screen → Done.')">How to make an app</button>
</div>

<script>
/* ====== State and defs ====== */
const SAVE_KEY = "idrc_clickajude_v3";

let state = {
  points: 0,
  perClick: 1,
  autoPerSec: 0,
  ascCoins: 0,
  adIndex: 0,
  clickUpgrades: [],
  autoUpgrades: [],
  ascensionUpgrades: [] // will store levels for ASC_DEFS in same index order
};

// click + auto defs (15 each)
const CLICK_DEFS = [
  ["Finger of Doom", 5],
  ["Titan Tap", 25],
  ["Nuclear Thumb", 120],
  ["Cosmic Punch", 600],
  ["Meteor Jab", 3000],
  ["Quantum Flick", 12000],
  ["Dragon Snap", 50000],
  ["Plasma Knuckle", 180000],
  ["Galactic Push", 700000],
  ["Stellar Slap", 2500000],
  ["Eclipse Strike", 9000000],
  ["Omega Jab", 35000000],
  ["Void Swipe", 140000000],
  ["Infinity Tap", 600000000],
  ["Reality Punch", 2500000000]
];

const AUTO_DEFS = [
  ["Intern on Minimum Wage", 2],
  ["Student Temp Worker", 10],
  ["Freelance Bot", 45],
  ["AI Assistant", 220],
  ["Assembly Line", 900],
  ["Factory Farm", 4200],
  ["Commerce Portal", 18000],
  ["Data Center", 75000],
  ["Alien Mining Rig", 320000],
  ["Black Hole Extractor", 1200000],
  ["Orbital Driller", 5000000],
  ["Planetary Mine", 20000000],
  ["Stellar Forge", 90000000],
  ["Cosmic Foundry", 400000000],
  ["Multiverse Vault", 1700000000]
];

// ascension upgrades (buy with asc coins)
const ASC_DEFS = [
  { name: "Bonus Start", effect: 100000, desc: "Start with bonus money after Ascend", costBase: 2 },
  { name: "Extra Coins", effect: 1, desc: "Gain +1 extra asc coin per Ascend", costBase: 4 },
  { name: "Click Multiplier", effect: 2, desc: "×2 click power per level", costBase: 6 }
];

// ad links
const AD_LINKS = [
  "https://singingfiles.com/show.php?l=0&u=2434684&id=69146",
  "https://singingfiles.com/show.php?l=0&u=2434684&id=69339",
  "https://singingfiles.com/show.php?l=0&u=2434684&id=66573",
  "https://singingfiles.com/show.php?l=0&u=2434684&id=69145",
  "https://singingfiles.com/show.php?l=0&u=2434684&id=68846"
];

/* ====== DOM refs ====== */
const moneyEl = document.getElementById("moneyDisplay");
const perClickEl = document.getElementById("perClickDisplay");
const autoEl = document.getElementById("autoDisplay");
const ascEl = document.getElementById("ascDisplay");
const clickImg = document.getElementById("clickImg");
const clickGrid = document.getElementById("clickGrid");
const autoGrid = document.getElementById("autoGrid");
const ascGrid = document.getElementById("ascGrid");
const ascendBtn = document.getElementById("ascendBtn");
const adButton = document.getElementById("adButton");
const adStatus = document.getElementById("adStatus");
const ascCoinsEl = document.getElementById("ascCoins");
const modalBackdrop = document.getElementById("modalBackdrop");
const modalText = document.getElementById("ascModalText");
const modalConfirm = document.getElementById("modalConfirm");
const modalCancel = document.getElementById("modalCancel");
const exportBtn = document.getElementById("exportBtn");
const importBtn = document.getElementById("importBtn");
const resetBtn = document.getElementById("resetBtn");
const floatRoot = document.getElementById("floatRoot");

/* ====== Utils ====== */
function fmt(n){
  if (n >= 1e12) return (n/1e12).toFixed(2) + "T";
  if (n >= 1e9) return (n/1e9).toFixed(2) + "B";
  if (n >= 1e6) return (n/1e6).toFixed(2) + "M";
  if (n >= 1e3) return (n/1e3).toFixed(1) + "k";
  return String(Math.floor(n));
}

function saveState(){
  try { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); } catch(e){ console.warn("Save failed", e); }
}

function loadState(){
  try {
    const raw = localStorage.getItem(SAVE_KEY);
    if (raw) {
      const parsed = JSON.parse(raw);
      state = { ...state, ...parsed };
      state.clickUpgrades = state.clickUpgrades || [];
      state.autoUpgrades = state.autoUpgrades || [];
      state.ascensionUpgrades = state.ascensionUpgrades || [];
    }
  } catch(e){ console.warn("Load failed", e); }
}

/* spawn float + small sparks */
function spawnFloat(x,y,text,color="#00e6ff"){
  const el = document.createElement("div");
  el.className = "float";
  el.style.left = (x - 10) + "px";
  el.style.top = (y - 12) + "px";
  el.style.color = color;
  el.textContent = text;
  floatRoot.appendChild(el);
  let t = 0;
  const id = setInterval(()=>{
    t++;
    el.style.transform = `translateY(${-t*1.8}px) scale(${1 + t*0.004})`;
    el.style.opacity = String(1 - t/40);
    if (t > 40) { clearInterval(id); el.remove(); }
  }, 16);
  for (let i=0;i<5;i++){
    const sp = document.createElement("div");
    sp.className = "spark";
    sp.style.left = (x + (Math.random()*60-30)) + "px";
    sp.style.top = (y + (Math.random()*30-15)) + "px";
    sp.style.background = `hsl(${Math.random()*60+180},80%,60%)`;
    floatRoot.appendChild(sp);
    let tt=0;
    const id2 = setInterval(()=>{
      tt++;
      sp.style.opacity = String(1 - tt/30);
      sp.style.transform = `translate(${(Math.random()*2-1)*tt*2}px, ${-tt*3 - Math.random()*8}px) scale(${1 - tt/60})`;
      if (tt>30){ clearInterval(id2); sp.remove(); }
    },16);
  }
}

/* asc click multiplier from ascension upgrades */
function ascClickMultiplier(){
  const lvl = (state.ascensionUpgrades[2] && state.ascensionUpgrades[2].level) || 0;
  return Math.pow(ASC_DEFS[2].effect, lvl);
}

/* starting bonus from ascension upgrades */
function ascStartBonus(){
  const lvl = (state.ascensionUpgrades[0] && state.ascensionUpgrades[0].level) || 0;
  return lvl * (ASC_DEFS[0].effect || 0);
}

/* extra coins from ascension upgrades */
function ascExtraCoins(){
  const lvl = (state.ascensionUpgrades[1] && state.ascensionUpgrades[1].level) || 0;
  return lvl * (ASC_DEFS[1].effect || 0);
}

/* ====== Init defaults ====== */
function initDefaults(){
  if (!state.clickUpgrades || state.clickUpgrades.length !== CLICK_DEFS.length){
    state.clickUpgrades = CLICK_DEFS.map(()=>({ level:0 }));
  }
  if (!state.autoUpgrades || state.autoUpgrades.length !== AUTO_DEFS.length){
    state.autoUpgrades = AUTO_DEFS.map(()=>({ level:0 }));
  }
  if (!state.ascensionUpgrades || state.ascensionUpgrades.length !== ASC_DEFS.length){
    state.ascensionUpgrades = ASC_DEFS.map(()=>({ level:0 }));
  }
}

/* ====== Render / UI ====== */
function updateTop(){
  moneyEl.textContent = "$" + fmt(state.points);
  perClickEl.textContent = fmt(state.perClick * ascClickMultiplier());
  autoEl.textContent = fmt(state.autoPerSec);
  ascEl.textContent = state.ascCoins;
  ascCoinsEl.textContent = state.ascCoins;
  ascendBtn.style.display = (state.points >= 5_000_000) ? "block" : "none";
  // ad status
  if (state.adIndex >= AD_LINKS.length) {
    adStatus.textContent = "No more ads available";
    adButton.classList.add("disabled");
    adButton.textContent = "No more ads";
  } else {
    adStatus.textContent = `Ads left: ${AD_LINKS.length - state.adIndex}`;
    adButton.classList.remove("disabled");
    adButton.textContent = `Watch Ad (+50,000)`;
  }
}

function renderUpgrades(){
  // click upgrades (harder: multiplier 1.25)
  clickGrid.innerHTML = "";
  CLICK_DEFS.forEach((d,i)=>{
    const base = d[1];
    const u = state.clickUpgrades[i];
    const cost = Math.max(1, Math.floor((base * 12) * Math.pow(1.25, u.level)));
    const card = document.createElement("div");
    card.className = "upgrade";
    if (state.points >= cost) card.classList.add("glow");
    card.innerHTML = `
      <div class="meta">
        <div class="title">${d[0]} <span style="font-weight:600;color:var(--muted);font-size:12px">Lv.${u.level}</span></div>
        <div class="desc">${base.toLocaleString()} per click</div>
      </div>
      <div class="cost">$${fmt(cost)}</div>
    `;
    card.addEventListener("click", ()=>{
      if (state.points >= cost){
        state.points -= cost;
        u.level++;
        state.perClick += base;
        spawnFloat(window.innerWidth/2, window.innerHeight/2 - 40, `+${fmt(base)}`, "#00ffd6");
        updateTop();
        renderUpgrades();
        saveState();
      } else {
        card.animate([{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(0)"}],{duration:200});
      }
    });
    clickGrid.appendChild(card);
  });

  // auto upgrades (harder: multiplier 1.22)
  autoGrid.innerHTML = "";
  AUTO_DEFS.forEach((d,i)=>{
    const base = d[1];
    const u = state.autoUpgrades[i];
    const cost = Math.max(1, Math.floor((base * 30) * Math.pow(1.22, u.level)));
    const card = document.createElement("div");
    card.className = "upgrade";
    if (state.points >= cost) card.classList.add("glow");
    card.innerHTML = `
      <div class="meta">
        <div class="title">${d[0]} <span style="font-weight:600;color:var(--muted);font-size:12px">Lv.${u.level}</span></div>
        <div class="desc">${fmt(base)} / sec</div>
      </div>
      <div class="cost">$${fmt(cost)}</div>
    `;
    card.addEventListener("click", ()=>{
      if (state.points >= cost){
        state.points -= cost;
        u.level++;
        state.autoPerSec += base;
        spawnFloat(window.innerWidth/2 + 30, window.innerHeight/2 - 20, `+${fmt(base)}/s`, "#ffd66e");
        updateTop();
        renderUpgrades();
        saveState();
      } else {
        card.animate([{transform:"translateY(0)"},{transform:"translateY(-6px)"},{transform:"translateY(6px)"},{transform:"translateY(0)"}],{duration:200});
      }
    });
    autoGrid.appendChild(card);
  });

  // ascension upgrades (buy with asc coins)
  ascGrid.innerHTML = "";
  ASC_DEFS.forEach((d,i)=>{
    const u = state.ascensionUpgrades[i];
    const cost = d.costBase * Math.pow(2, u.level); // grows in coins: base * 2^level
    const card = document.createElement("div");
    card.className = "upgrade";
    if (state.ascCoins >= cost) card.classList.add("glow");
    card.innerHTML = `
      <div class="meta">
        <div class="title">${d.name} <span style="font-weight:600;color:var(--muted);font-size:12px">Lv.${u.level}</span></div>
        <div class="desc">${d.desc}</div>
      </div>
      <div class="cost">${cost} ASC</div>
    `;
    card.addEventListener("click", ()=>{
      if (state.ascCoins >= cost){
        state.ascCoins -= cost;
        u.level++;
        // Apply effects immediately where relevant
        if (d.name === "Bonus Start"){
          // no immediate effect beyond changing start bonus (handled on next ascend)
        } else if (d.name === "Extra Coins"){
          // increases asc coins per ascend — handled in ascend calc
        } else if (d.name === "Click Multiplier"){
          // no immediate change to existing perClick (it multiplies on click via ascClickMultiplier)
        }
        updateTop();
        renderUpgrades();
        saveState();
      } else {
        card.animate([{transform:"scale(1)"},{transform:"scale(0.98)"},{transform:"scale(1)"}],{duration:160});
      }
    });
    ascGrid.appendChild(card);
  });
}

/* ====== Click handling ====== */
clickImg.addEventListener("click", (ev) => {
  // compute click value with ascension multiplier
  const baseValue = Math.floor(state.perClick);
  const multiplier = ascClickMultiplier();
  const value = Math.floor(baseValue * multiplier);
  state.points += value;
  spawnFloat(ev.clientX, ev.clientY, `+$${fmt(value)}`, "#00e6ff");
  updateTop();
  saveState();
});

/* keyboard clicks */
window.addEventListener("keydown", (e) => {
  if ((e.code === "Space" || e.key === " " || e.key === "Enter") && !e.repeat) {
    e.preventDefault();
    // emulate click at center
    const rect = clickImg.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    clickImg.click();
  }
});

/* auto loop */
let autoTimer = null;
function startAuto(){
  if (autoTimer) clearInterval(autoTimer);
  autoTimer = setInterval(()=>{
    if (state.autoPerSec > 0){
      const gain = Math.floor(state.autoPerSec);
      state.points += gain;
      spawnFloat(window.innerWidth/2 + 30, window.innerHeight/2 + 20, `+$${fmt(gain)}`, "#ffd66e");
      updateTop();
      saveState();
    }
  }, 1000);
}

/* ====== Ascension flow ====== */
function openAscensionModal(){
  const coinsFromPoints = Math.floor(state.points / 5_000_000);
  const coinsEarned = coinsFromPoints + ascExtraCoins();
  modalText.innerHTML = `You have <b>$${fmt(state.points)}</b>.<br>Ascending will reset money and upgrades but grant <b>${coinsEarned}</b> ascension coin(s). Ascension upgrades persist. Proceed?`;
  modalBackdrop.style.display = "flex";
  modalBackdrop.setAttribute("aria-hidden","false");
}
function closeAscModal(){ modalBackdrop.style.display = "none"; modalBackdrop.setAttribute("aria-hidden","true"); }

ascendBtn.addEventListener("click", openAscensionModal);
modalCancel.addEventListener("click", closeAscModal);
modalBackdrop.addEventListener("click", (ev) => { if (ev.target === modalBackdrop) closeAscModal(); } );

modalConfirm.addEventListener("click", ()=>{
  const coinsFromPoints = Math.floor(state.points / 5_000_000);
  const coinsEarned = coinsFromPoints + ascExtraCoins();
  state.ascCoins += coinsEarned;
  // compute starting bonus from asc upgrades
  const bonus = ascStartBonus();
  // reset core progress
  state.points = bonus || 0;
  state.perClick = 1; // reset base click value
  state.autoPerSec = 0;
  // reset upgrade levels and not ascension levels
  state.clickUpgrades.forEach((u)=>{ u.level = 0; });
  state.autoUpgrades.forEach((u)=>{ u.level = 0; });
  // recalc perClick and autoPerSec from zero (they were accumulated before)
  state.perClick = 1;
  state.autoPerSec = 0;
  saveState();
  renderUpgrades();
  updateTop();
  closeAscModal();
  spawnFloat(window.innerWidth/2, window.innerHeight/2, `+${coinsEarned} ASC`, "#7b61ff");
  alert(`Ascended! +${coinsEarned} ascension coin(s).`);
});

/* ====== Ads ====== */
adButton.addEventListener("click", (ev) => {
  if (state.adIndex >= AD_LINKS.length) return;
  // reward first (immediate)
  state.points += 50000;
  spawnFloat(window.innerWidth/2 + (Math.random()*80-40), window.innerHeight/2 - 20, "+$50k", "#ffea00");
  updateTop();
  saveState();

  // open ad via <a> click (should be user gesture)
  const link = AD_LINKS[state.adIndex];
  state.adIndex = (state.adIndex + 1);
  const a = document.createElement("a");
  a.href = link;
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  a.click();

  updateTop();
});

/* ====== Export / Import / Reset ====== */
exportBtn.addEventListener("click", ()=>{
  const blob = new Blob([JSON.stringify(state)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "idrc_clickajude_save.json";
  a.click();
  URL.revokeObjectURL(url);
});

importBtn.addEventListener("click", ()=>{
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "application/json";
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const parsed = JSON.parse(reader.result);
        // basic validation/merge
        state = { ...state, ...parsed };
        initDefaults();
        renderUpgrades();
        updateTop();
        saveState();
        startAuto();
        alert("Save imported.");
      } catch(err){ alert("Invalid save file."); }
    };
    reader.readAsText(file);
  };
  input.click();
});

resetBtn.addEventListener("click", ()=>{
  if (!confirm("Reset all progress? This cannot be undone.")) return;
  localStorage.removeItem(SAVE_KEY);
  state = {
    points: 0, perClick: 1, autoPerSec: 0, ascCoins: 0, adIndex: 0,
    clickUpgrades: [], autoUpgrades: [], ascensionUpgrades: []
  };
  initDefaults();
  renderUpgrades();
  updateTop();
  saveState();
});

/* ====== Boot ====== */
function boot(){
  loadState();
  initDefaults();
  renderUpgrades();
  updateTop();
  startAuto();
  adStatus.textContent = `Ads left: ${Math.max(0, AD_LINKS.length - state.adIndex)}`;
  setInterval(saveState, 3000); // autosave
}
boot();

</script>
</body>
</html>
